<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyCast Dashboard | Smart Weather Tracking</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" th:href="@{/css/style.css}">

    <style>
        .hero-section {
            padding: 140px 0 60px;
            position: relative;
            overflow: hidden;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #FFFFFF 0%, #A5B4FC 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2.5rem;
            max-width: 600px;
        }

        .search-wrapper {
            position: relative;
            max-width: 600px;
            margin: 0 auto 3rem;
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.2rem;
            z-index: 10;
        }

        .search-input {
            padding-left: 50px;
            font-size: 1.1rem;
            height: 60px;
        }

        .user-greeting {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.15), rgba(16, 185, 129, 0.15));
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            margin-left: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }

        .weather-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .locations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
<div class="bg-pattern"></div>


<nav class="navbar">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <div class="navbar-brand">
                <i class="bi bi-cloud-lightning-rain-fill"></i>
                <span>SkyCast</span>
            </div>

            <div style="display: flex; align-items: center; gap: 15px;">
                <a href="/about" class="btn btn-outline btn-sm">
                    <i class="bi bi-info-circle"></i> About
                </a>

                <button class="btn btn-primary btn-sm" id="refreshBtn" title="Refresh Data">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>

                <div th:if="${user != null}" class="user-dropdown" style="position: relative;">
                    <button class="btn btn-outline btn-sm dropdown-toggle"
                            style="display: flex; align-items: center; gap: 8px; background: rgba(79, 70, 229, 0.1); border: 1px solid rgba(255, 255, 255, 0.1);">
                        <i class="bi bi-person-circle"></i>
                        <span style="font-weight: 600;" th:text="${user.login}"></span>
                        <i class="bi bi-chevron-down" style="font-size: 0.8rem;"></i>
                    </button>

                    <div class="dropdown-menu" style="position: absolute; top: 100%; right: 0; margin-top: 5px;
                         background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(20px);
                         border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg);
                         padding: 0.5rem; min-width: 180px; display: none; z-index: 1000;">
                        <div style="padding: 0.75rem 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
                            <div style="font-weight: 600;" th:text="${user.login}"></div>
                            <div style="font-size: 0.8rem; color: rgba(255, 255, 255, 0.5);">Logged in</div>
                        </div>
                        <form th:action="@{/logout}" method="post" style="margin: 0;">
                            <button type="submit" style="width: 100%; text-align: left; background: none; border: none;
                                    color: rgba(255, 255, 255, 0.8); padding: 0.75rem 1rem; cursor: pointer;
                                    display: flex; align-items: center; gap: 10px; border-radius: var(--radius-md);">
                                <i class="bi bi-box-arrow-right" style="color: #EF4444;"></i>
                                <span>Logout</span>
                            </button>
                        </form>
                    </div>
                </div>

                <script>
                    $(document).ready(function() {
                        $('.dropdown-toggle').click(function(e) {
                            e.stopPropagation();
                            $(this).next('.dropdown-menu').toggle();
                        });

                        $(document).click(function() {
                            $('.dropdown-menu').hide();
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</nav>

<main class="container">
    <section class="hero-section">
        <div class="glass" style="padding: 3rem; position: relative;">
            <h1 class="hero-title">Global Weather Intelligence</h1>
            <p class="hero-subtitle">
                Real-time forecasts, predictive analytics, and intelligent insights for every corner of the world
            </p>

            <div class="search-wrapper">
                <i class="bi bi-search search-icon"></i>
                <input type="text"
                       id="searchCity"
                       class="form-control search-input"
                       placeholder="Search for a city, country, or region..."
                       autocomplete="off">
                <div id="searchResults" class="search-results"></div>
            </div>

            <section class="glass" style="margin: 2rem 0; padding: 2rem;">
                <h3 class="section-title mb-4">
                    <i class="bi bi-bar-chart"></i>
                    Your Weather Insights
                </h3>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" style="color: #F59E0B;" id="currentLocationTemp">--°C</div>
                        <div>Current Location</div>
                        <div class="stat-trend" id="tempTrend" style="font-size: 0.85rem; margin-top: 5px;">
                            <i class="bi bi-dash"></i> <span>No change</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-value" style="color: #10B981;" id="weatherCondition">--</div>
                        <div>Condition</div>
                        <div class="stat-trend" id="conditionIcon" style="font-size: 1.2rem; margin-top: 5px;">
                            <i class="bi bi-question-circle"></i>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-value" style="color: #60A5FA;" id="precipitationChance">--%</div>
                        <div>Rain Chance</div>
                        <div class="stat-trend" id="rainTrend" style="font-size: 0.85rem; margin-top: 5px;">
                            <i class="bi bi-cloud-rain"></i> <span>Today</span>
                        </div>
                    </div>
                </div>

                <div class="insights-container mt-4" style="background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-lg); padding: 1.5rem;">
                    <h5 style="margin-bottom: 1rem; color: white; display: flex; align-items: center; gap: 10px;">
                        <i class="bi bi-lightbulb"></i>
                        Quick Insights
                    </h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div class="insight-item" style="color: rgba(255, 255, 255, 0.8);">
                            <i class="bi bi-thermometer" style="color: #EF4444; margin-right: 8px;"></i>
                            <span id="tempInsight">Calculating temperature insights...</span>
                        </div>
                        <div class="insight-item" style="color: rgba(255, 255, 255, 0.8);">
                            <i class="bi bi-wind" style="color: #10B981; margin-right: 8px;"></i>
                            <span id="windInsight">Wind conditions normal</span>
                        </div>
                        <div class="insight-item" style="color: rgba(255, 255, 255, 0.8);">
                            <i class="bi bi-umbrella" style="color: #60A5FA; margin-right: 8px;"></i>
                            <span id="rainInsight">No precipitation expected</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <section th:if="${weatherLocation != null}" class="glass weather-card fade-in" style="margin: 2rem 0;">
        <div class="weather-icon">
            <i class="bi bi-cloud-sun-fill"></i>
        </div>

        <div class="weather-info">
            <div class="d-flex align-items-center justify-content-center gap-3 mb-2 flex-wrap">
                <h2 style="font-size: 2.2rem; font-weight: 700;">
                    <span th:text="${weatherLocation.name}"></span>,
                    <span th:text="${weatherLocation.country}"></span>
                </h2>
                <div class="weather-badge">
                    <i class="bi bi-geo-alt"></i>
                    <span th:text="${#numbers.formatDecimal(weatherLocation.lat, 1, 2)}"></span>,
                    <span th:text="${#numbers.formatDecimal(weatherLocation.lon, 1, 2)}"></span>
                </div>
            </div>

            <div class="weather-temp">
                <span th:text="${#numbers.formatDecimal(weatherLocation.temp, 1, 0)}"></span>°C
            </div>

            <div id="weatherStats" class="weather-stats">
                <div class="loading-spinner" style="margin: 2rem auto;"></div>
                <p class="text-center mt-2" style="color: rgba(255, 255, 255, 0.6);">Calculating weather details...</p>
            </div>

            <div class="mt-4" style="display: flex; justify-content: center; gap: 1rem;">
                <div class="weather-meta" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                    <i class="bi bi-clock"></i>
                    Last updated: <span id="weatherUpdateTime">Just now</span>
                </div>
                <div class="weather-meta" style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                    <i class="bi bi-arrow-clockwise"></i>
                    Auto-update: <span id="weatherAutoUpdate">15 min</span>
                </div>
            </div>
        </div>
    </section>

    <section class="glass" style="margin: 2rem 0; padding: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
            <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                <i class="bi bi-clock-history"></i>
                <span>24-Hour Forecast</span>
            </h3>

            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-outline active" data-view="hourly">
                        <i class="bi bi-grid"></i> <span class="d-none d-md-inline">Hourly</span>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline" data-view="graph">
                        <i class="bi bi-graph-up"></i> <span class="d-none d-md-inline">Graph</span>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline" data-view="detailed">
                        <i class="bi bi-list-columns"></i> <span class="d-none d-md-inline">Details</span>
                    </button>
                </div>
                <button type="button" class="btn btn-sm btn-primary" id="refreshForecast">
                    <i class="bi bi-arrow-clockwise"></i> <span class="d-none d-md-inline">Update</span>
                </button>
            </div>
        </div>

        <div id="currentTimeIndicator" class="text-center mb-3" style="color: var(--primary-light); font-size: 0.9rem; display: none;">
            <i class="bi bi-info-circle"></i>
            <span>Forecast starts from current time: </span>
            <span id="currentTimeDisplay"></span>
        </div>

        <div id="hourlyView" class="forecast-view">
            <div class="hourly-forecast-container">
                <div id="hourlyForecast" class="hourly-forecast"></div>
            </div>
            <div class="text-center mt-3" style="color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">
                <i class="bi bi-arrow-left-right"></i> Scroll horizontally to see more hours
            </div>
        </div>

        <div id="graphView" class="forecast-view" style="display: none;">
            <div class="forecast-graph">
                <canvas id="temperatureChart"></canvas>
            </div>
            <div class="graph-legend" style="display: flex; justify-content: center; gap: 2rem; margin-top: 1.5rem; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 20px; height: 3px; background: var(--primary);"></div>
                    <span style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Temperature (°C)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 20px; height: 3px; background: var(--secondary); border-radius: 1.5px;"></div>
                    <span style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Feels Like (°C)</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 20px; height: 8px; background: rgba(96, 165, 250, 0.3); border-radius: 4px;"></div>
                    <span style="color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">Rain Chance (%)</span>
                </div>
            </div>
        </div>

        <div id="detailedView" class="forecast-view" style="display: none;">
            <div class="detailed-forecast-container">
                <div class="detailed-forecast-header" style="display: grid; grid-template-columns: repeat(6, 1fr);
                    gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 10px;
                    margin-bottom: 0.5rem; font-weight: 600; color: rgba(255, 255, 255, 0.9);">
                    <div>Time</div>
                    <div>Condition</div>
                    <div>Temp</div>
                    <div>Feels Like</div>
                    <div>Rain</div>
                    <div>Wind</div>
                </div>
                <div id="detailedForecast" class="detailed-forecast"></div>
            </div>
            <div class="text-center mt-3" style="color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">
                <i class="bi bi-info-circle"></i> Detailed forecast for the next 24 hours
            </div>
        </div>

        <button type="button" class="btn btn-sm btn-outline" id="toggleSummary">
            <i class="bi bi-chevron-up"></i> Hide
        </button>
        <div class="forecast-summary mt-4" style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg); display: none;" id="forecastSummary">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <div>
                    <h5 style="margin-bottom: 0.5rem; color: white;">Today's Highlights</h5>
                    <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                        <div>
                            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">Highest Temp</div>
                            <div style="font-size: 1.2rem; font-weight: 700;" id="maxTemp">--°C</div>
                        </div>
                        <div>
                            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">Lowest Temp</div>
                            <div style="font-size: 1.2rem; font-weight: 700;" id="minTemp">--°C</div>
                        </div>
                        <div>
                            <div style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">Rain Expected</div>
                            <div style="font-size: 1.2rem; font-weight: 700;" id="rainHours">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="glass" style="padding: 2.5rem; margin: 3rem 0;">
        <div class="locations-header">
            <h3 class="section-title">
                <i class="bi bi-bookmark-star-fill"></i>
                Your Saved Locations
            </h3>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary btn-sm" id="sortBtn">
                    <i class="bi bi-sort-alpha-down"></i> Sort A-Z
                </button>
                <button class="btn btn-outline btn-sm" id="exportBtn">
                    <i class="bi bi-download"></i> Export
                </button>
            </div>
        </div>

        <div id="userLocationsContainer">
            <div class="empty-state">
                <i class="bi bi-geo-alt empty-state-icon"></i>
                <h4>No locations saved yet</h4>
                <p style="margin-top: 10px;">Search for a city and click "Add" to save it here</p>
            </div>
        </div>
    </section>
</main>

<footer style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.4); font-size: 0.9rem;">
    <p>© 2025 SkyCast Weather Intelligence. All weather data is updated in real-time.</p>
    <p style="margin-top: 5px;">
        <i class="bi bi-shield-check" style="margin-right: 5px;"></i>
        Secure connection •
        <i class="bi bi-lightning-charge" style="margin-left: 15px; margin-right: 5px;"></i>
        Real-time updates
    </p>
</footer>

<script th:src="@{/js/search.js}"></script>
<script th:src="@{/js/forecast.js}"></script>
<script th:src="@{/js/weatherStats.js}"></script>

<script>
    $(document).ready(function() {
        // Update locations count
        function updateLocationsCount() {
            $.get('/getUserLocations', function(locations) {
                $('#locationsCount').text(locations.length);
            });
        }

        $('#refreshBtn').click(function() {
            const $btn = $(this);
            $btn.find('i').addClass('fa-spin');

            setTimeout(() => {
                loadUserLocations();
                $btn.find('i').removeClass('fa-spin');
                $btn.addClass('pulse');
                setTimeout(() => $btn.removeClass('pulse'), 500);
            }, 800);
        });

        $('#sortBtn').click(function() {
            const $container = $('#userLocationsContainer');
            $container.addClass('shimmer');

            setTimeout(() => {
                const items = $container.find('.location-card').get();
                items.sort((a, b) => {
                    const aText = $(a).find('strong').text().toLowerCase();
                    const bText = $(b).find('strong').text().toLowerCase();
                    return aText.localeCompare(bText);
                });

                $container.empty().append(items);
                $container.removeClass('shimmer');
            }, 300);
        });

        $('#exportBtn').click(function() {
            alert('Export functionality would save your locations as JSON file');
        });

        updateLocationsCount();
    });
</script>
</body>
</html>